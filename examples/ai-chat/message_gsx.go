// Code generated by tui generate. DO NOT EDIT.
// Source: message.gsx

package main

import (
	"fmt"

	tui "github.com/grindlemire/go-tui"
)

type messageView struct {
	msg      Message
	index    int
	focused  bool
	events   *tui.Events[ChatEvent]
	copyBtn  *tui.Ref
	retryBtn *tui.Ref
}

func MessageView(msg Message, index int, focused bool, events *tui.Events[ChatEvent]) *messageView {
	return &messageView{
		msg:      msg,
		index:    index,
		focused:  focused,
		events:   events,
		copyBtn:  tui.NewRef(),
		retryBtn: tui.NewRef(),
	}
}

func (m *messageView) HandleMouse(me tui.MouseEvent) bool {
	return tui.HandleClicks(me,
		tui.Click(m.copyBtn, func() {
			m.events.Emit(ChatEvent{Type: "copy", Payload: m.msg.Content})
		}),
		tui.Click(m.retryBtn, func() {
			m.events.Emit(ChatEvent{Type: "retry", Payload: fmt.Sprintf("%d", m.index)})
		}),
	)
}

func (m *messageView) border() tui.BorderStyle {
	return tui.BorderRounded
}

func (m *messageView) borderStyle() tui.Style {
	if m.msg.Role == "assistant" {
		if m.focused {
			return tui.NewStyle().Foreground(tui.Cyan)
		}
		return tui.NewStyle().Foreground(tui.Blue)
	}
	if m.focused {
		return tui.NewStyle().Foreground(tui.White)
	}
	return tui.NewStyle()
}

func (m *messageView) roleIcon() string {
	if m.msg.Role == "assistant" {
		return ""
	}
	return ""
}

func (m *messageView) roleTextStyle() tui.Style {
	if m.msg.Role == "assistant" {
		return tui.NewStyle().Bold().Foreground(tui.Cyan)
	}
	return tui.NewStyle().Bold().Foreground(tui.White)
}

func (m *messageView) Render() *tui.Element {
	__tui_0 := tui.New(
		tui.WithBorder(m.border()),
		tui.WithBorderStyle(m.borderStyle()),
		tui.WithPadding(1),
		tui.WithMargin(1),
	)
	__tui_1 := tui.New(
		tui.WithDirection(tui.Column),
		tui.WithGap(1),
	)
	__tui_2 := tui.New(
		tui.WithDirection(tui.Row),
		tui.WithJustify(tui.JustifySpaceBetween),
	)
	__tui_3 := tui.New(
		tui.WithText(m.roleIcon()+" "+m.msg.Role),
		tui.WithTextStyle(m.roleTextStyle()),
	)
	__tui_2.AddChild(__tui_3)
	__tui_4 := tui.New(
		tui.WithDirection(tui.Row),
		tui.WithGap(1),
	)
	if m.msg.Duration > 0 {
		__tui_5 := tui.New(
			tui.WithText(fmt.Sprintf("%.1fs", m.msg.Duration.Seconds())),
			tui.WithTextStyle(tui.NewStyle().Dim()),
		)
		__tui_4.AddChild(__tui_5)
	}
	if m.msg.Role == "assistant" && !m.msg.Streaming {
		__tui_6 := tui.New(
			tui.WithTextStyle(tui.NewStyle().Dim()),
		)
		m.retryBtn.Set(__tui_6)
		__tui_7 := tui.New(tui.WithText("[r]"))
		__tui_6.AddChild(__tui_7)
		__tui_4.AddChild(__tui_6)
	}
	__tui_8 := tui.New(
		tui.WithTextStyle(tui.NewStyle().Dim()),
	)
	m.copyBtn.Set(__tui_8)
	__tui_9 := tui.New(tui.WithText("[c]"))
	__tui_8.AddChild(__tui_9)
	__tui_4.AddChild(__tui_8)
	__tui_2.AddChild(__tui_4)
	__tui_1.AddChild(__tui_2)
	__tui_10 := tui.New()
	__tui_11 := tui.New(
		tui.WithText(m.msg.Content),
		tui.WithTextStyle(tui.NewStyle().Foreground(tui.White)),
	)
	__tui_10.AddChild(__tui_11)
	if m.msg.Streaming {
		__tui_12 := tui.New(
			tui.WithText(""),
			tui.WithTextStyle(tui.NewStyle().Foreground(tui.Cyan).Bold()),
		)
		__tui_10.AddChild(__tui_12)
	}
	__tui_1.AddChild(__tui_10)
	__tui_0.AddChild(__tui_1)

	return __tui_0
}
